<%= javascript_include_tag"http://www.google.com/jsapi", "markerclusterer" %>

<script type="text/javascript">
  var coordinates = "<%= @reports.collect {|c| c.coordinates+"|" } %>";
  var myLatLng = new Array();
  var arr = new Array();
  arr = coordinates.split("|");

  google.load('maps', '3', {
    other_params: 'sensor=false'
  });
  google.setOnLoadCallback(initialize);

  function initialize() {
    var center = new google.maps.LatLng(41.269550, 74.766098);

    var map = new google.maps.Map(document.getElementById('cluster_map'), {
      zoom: 7,
      center: center,
      minZoom: 7,
      streetViewControl: false,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    });

    var markers = [];
    for (var i=0; i < arr.length-1; i++) {
      myLatLng = arr[i].split(", ");
      
      var latLng = new google.maps.LatLng(myLatLng[0], myLatLng[1]);
      var marker = new google.maps.Marker({
        position: latLng,
      });
      markers.push(marker);
    }

    var markerCluster = new MarkerClusterer(map, markers);
  }
</script>
<div id="featured" class="col-full">
  <div id="loopedSlider">

    <div class="container" style="height: 470px; display: block;">
      <div class="map" id="cluster_map" style="height:450px;"></div>
    </div>

    <div class="fix"></div>

    <div class="slider-nav col-full">

      <ul class="pagination">
        <li class=""><a href="#" onclick="goto_state('bi');" rel="1">Бишкек</a></li>
        <li class=""><a href="#" onclick="goto_state('co');" rel="2">Чуй</a></li>
        <li class=""><a href="#" onclick="goto_state('oo');" rel="3">Ош</a></li>
        <li class=""><a href="#" onclick="goto_state('bo');" rel="3">Баткен</a></li>
        <li class=""><a href="#" onclick="goto_state('jo');" rel="3">Джалал-Абад</a></li>
        <li class=""><a href="#" onclick="goto_state('to');" rel="3">Талас</a></li>
        <li class=""><a href="#" onclick="goto_state('no');" rel="3">Нарын</a></li>
        <li class=""><a href="#" onclick="goto_state('io');" rel="3">Иссык-Куль</a></li>
      </ul>
    </div>

  </div>
</div>
<div id="content" class="col-full">
  <div id="main" class="col-left box">
    <div class="post">
      <div id="orders_chart" style="width: 540px;">
        <script type="text/javascript" charset="utf-8">
            $(function() {
                new Highcharts.Chart({
                    chart: {
                        renderTo: 'orders_chart',
//                        plotBackgroundColor: 'rgba(255, 255, 255, .9)',
//                        plotShadow: true,
                        defaultSeriesType: 'spline',
                        width: 540,
                        height: 280,
                        borderWidth: 1
                    },
                    xAxis: {
                        type: 'datetime',
                        labels: {
                            style: {
                                color: '#000',
                                font: '11px Trebuchet MS, Verdana, sans-serif',

                            }
                        },

                    },
                    yAxis: {
                        min: 0,
                        title: { text: 'Reports' },
                        labels: {
                            style: {
                                color: '#000',
                                font: '11px Trebuchet MS, Verdana, sans-serif'
                            }
                        },
                    },
                    title: { text: 'Статистика проблем' },
                    plotOptions: {
                        series: {
                            cursor: 'pointer',
                        }
                    },

                    tooltip: {
                        formatter: function () {
    return Highcharts.dateFormat("%B %e %Y", this.x) + ' Found ' + ': ' + Highcharts.numberFormat(this.y, 0);
                        }
                    },

                    series: [
                        {
                            name: "Проблемы",
                            pointInterval: <%= 1.day * 1000 %>,
                            pointStart: <%= 3.weeks.ago.at_midnight.to_i * 1000 %>,
                            data: <%= (3.weeks.ago.to_date..Date.today).map { |date| Report.total_on(date)}.inspect %>
                        }
                    ]
                });
            });

        </script>
      </div>
    </div>
  </div>

  <div id="sidebar" class="col-right">

    <!-- Widgetized Sidebar -->
    <div class="widget widget_pages"><h3>Статистика</h3>
    <div id="month_stat">

      <%= Report.total_month()   %>



      </div>

    </div>

  </div>

</div>